<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pricing and Supply problem &mdash; Gurobi Machine Learning  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->

        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/design-tabs.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference manual" href="../meta-api.html" />
    <link rel="prev" title="Student Enrollment" href="student_admission.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Gurobi Machine Learning
            <img src="../_static/gurobi-logo-title.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0.0.dev1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firststeps-introduction.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firststeps-simple-example.html">Usage Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning Models</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../mlm-supported.html">Supported Regression models</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../mlm-examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="2DPeakFunction.html">Surrogate functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="adversarial_mnist.html">Adversarial Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="student_admission.html">Student Enrollment</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Pricing and Supply problem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Load-the-Packages-and-the-Datasets">Load the Packages and the Datasets</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Extra-required-packages">Extra required packages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Prepare-the-Dataset">Prepare the Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Part-I:-Observe-Trends-in-the-Data">Part I: Observe Trends in the Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Sales-Over-the-Years">Sales Over the Years</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Seasonality">Seasonality</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Correlations">Correlations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Regions">Regions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Part-II:-Predict-the-Sales">Part II: Predict the Sales</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Part-III:-Optimize-for-Price-and-Supply-of-Avocados">Part III: Optimize for Price and Supply of Avocados</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Input-Parameters">Input Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Decision-Variables">Decision Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Set-the-Objective">Set the Objective</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Add-the-Supply-Constraint">Add the Supply Constraint</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Add-Constraints-That-Define-Sales-Quantity">Add Constraints That Define Sales Quantity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Add-the-Wastage-Constraints">Add the Wastage Constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Fire-Up-the-Solver">Fire Up the Solver</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../meta-api.html">API Reference manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../meta-bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../meta-contactus.html">Contact Us</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Gurobi Machine Learning</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../mlm-examples.html">Examples</a> &raquo;</li>
      <li>Pricing and Supply problem</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/mlm-examples/price_optimization.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">


<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Pricing-and-Supply-problem">
<h1>Pricing and Supply problem<a class="headerlink" href="#Pricing-and-Supply-problem" title="Permalink to this heading"></a></h1>
<p><em>Note: This example is a limited version of the example</em> <a class="reference external" href="https://github.com/Gurobi/modeling-examples/tree/master/price_optimization">How Much Is Too Much? Avocado Pricing and Supply Using Mathematical Optimization</a><em>. It is only aimed at showing the capabilities of Gurobi Machine Learning. In particular the model is restricted to a limited number of regions so that it can fits within Gurobi size-limited license. Please visit the full notebook page, for a more detailed explanation about the
problem and detailed analysis of the results.</em></p>
<p>A <a class="reference external" href="https://www.foodnetwork.com/fn-dish/news/2018/3/avocado-unseats-banana-as-america-s-top-fruit-import-by-value">Food Network article</a> from March 2017 declared, “Avocado unseats banana as America’s top fruit import.” This declaration is incomplete and debatable for reasons other than whether avocado is a fruit. Avocados are expensive.</p>
<p>As a supplier, setting an appropriate avocado price requires a delicate trade-off. Set it too high and you lose customers. Set it too low and you won’t make a profit. Equipped with good data, the avocado pricing and supply problem is <em>ripe</em> with opportunities for demonstrating the power of optimization and data science.</p>
<p>They say when life gives you avocados, make guacamole. Just like the perfect guacamole needs the right blend of onion, lemon and spices, finding an optimal avocado price needs the right blend of descriptive, predictive and prescriptive analytics.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><img alt="6ea12cfdad204cc299a957d9177a285e" class="no-scaled-link" src="https://github.com/Gurobi/modeling-examples/blob/master/price_optimization/avocado_image_grocery.jpeg?raw=1" style="width: 500px;" /></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Avocados: a quintessential corner of a grocery store. Image Credits: <a class="reference external" href="https://nypost.com/2022/02/15/us-will-halt-mexico-avocado-imports-as-long-as-necessary/">New York Post</a></p></td>
</tr>
</tbody>
</table>
<p><strong>Goal</strong>: Develop a data science pipeline for pricing and distribution of avocados to maximize revenue.</p>
<p>This notebook walks through a decision-making pipeline that culminates in a mathematical optimization model. There are three stages: - First, understand the dataset and infer the relationships between categories such as the sales, price, region, and seasonal trends. - Second, build a prediction model that predicts the demand for avocados as a function of price, region, year and the seasonality. - Third, design an optimization problem that sets the optimal price and supply quantity to maximize
the net revenue while incorporating costs for wastage and transportation.</p>
<section id="Load-the-Packages-and-the-Datasets">
<h2>Load the Packages and the Datasets<a class="headerlink" href="#Load-the-Packages-and-the-Datasets" title="Permalink to this heading"></a></h2>
<p>We use real sales data provided by the <a class="reference external" href="https://hassavocadoboard.com/">Hass Avocado Board</a> (HAB), whose aim is to “make avocados America’s most popular fruit”. This dataset contains consolidated information on several years’ worth of market prices and sales of avocados.</p>
<p>We will now load the following packages for analyzing and visualizing the data.</p>
<section id="Extra-required-packages">
<h3>Extra required packages<a class="headerlink" href="#Extra-required-packages" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>seaborn</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">tree</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<p>The dataset from HAB contains sales data for the years 2019-2022. This data is augmented by a previous download from HAB available on <a class="reference external" href="https://www.kaggle.com/datasets/timmate/avocado-prices-2020">Kaggle</a> with sales for the years 2015-2018.</p>
<p>Each row in the dataset is the weekly number of avocados sold and the weekly average price of an avocado categorized by region and type of avocado. There are two types of avocados: conventional and organic. In this notebook, we will only consider the conventional avocados. There are eight large regions relevant for this example, namely the Great Lakes, Midsouth, North East, Northern New England, South Central, South East, West and Plains.</p>
<p>Now, load the data and store it into a Pandas dataframe.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avocado</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/Gurobi/modeling-examples/master/price_optimization/HABdata_2019_2022.csv&#39;</span><span class="p">)</span> <span class="c1"># dataset downloaded directly from HAB</span>
<span class="n">avocado_old</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/Gurobi/modeling-examples/master/price_optimization/kaggledata_till2018.csv&#39;</span><span class="p">)</span> <span class="c1"># dataset downloaded from Kaggle</span>
<span class="n">avocado</span> <span class="o">=</span> <span class="n">avocado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avocado_old</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">avocado</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region</th>
      <th>date</th>
      <th>type</th>
      <th>price</th>
      <th>units_sold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Great_Lakes</td>
      <td>1/7/19 0:00</td>
      <td>Conventional</td>
      <td>1.106743</td>
      <td>3812441.96</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Great_Lakes</td>
      <td>1/7/19 0:00</td>
      <td>Organic</td>
      <td>1.371280</td>
      <td>275987.52</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Great_Lakes</td>
      <td>1/13/19 0:00</td>
      <td>Conventional</td>
      <td>1.063457</td>
      <td>3843318.68</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Great_Lakes</td>
      <td>1/13/19 0:00</td>
      <td>Organic</td>
      <td>1.493384</td>
      <td>244991.95</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Great_Lakes</td>
      <td>1/20/19 0:00</td>
      <td>Conventional</td>
      <td>1.049931</td>
      <td>4587957.69</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>6799</th>
      <td>West</td>
      <td>11/18/18</td>
      <td>Organic</td>
      <td>1.610000</td>
      <td>334096.14</td>
    </tr>
    <tr>
      <th>6800</th>
      <td>West</td>
      <td>11/25/18</td>
      <td>Conventional</td>
      <td>1.240000</td>
      <td>3260102.17</td>
    </tr>
    <tr>
      <th>6801</th>
      <td>West</td>
      <td>11/25/18</td>
      <td>Organic</td>
      <td>1.730000</td>
      <td>268362.34</td>
    </tr>
    <tr>
      <th>6802</th>
      <td>West</td>
      <td>12/2/18</td>
      <td>Conventional</td>
      <td>1.200000</td>
      <td>4594863.86</td>
    </tr>
    <tr>
      <th>6803</th>
      <td>West</td>
      <td>12/2/18</td>
      <td>Organic</td>
      <td>1.620000</td>
      <td>268969.03</td>
    </tr>
  </tbody>
</table>
<p>6804 rows × 5 columns</p>
</div></div>
</div>
</section>
</section>
<section id="Prepare-the-Dataset">
<h2>Prepare the Dataset<a class="headerlink" href="#Prepare-the-Dataset" title="Permalink to this heading"></a></h2>
<p>We will now prepare the data for making sales predictions. Add new columns to the dataframe for the year and seasonality. Let each year from 2015 through 2022 be given an index from 0 through 7 in the increasing order of the year. We will define the peak season to be the months of February through July. These months are set based on visual inspection of the trends, but you can try setting other months.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the index for each year from 2015 through 2022</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">year</span>
<span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;year_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2015</span>
<span class="n">avocado</span> <span class="o">=</span> <span class="n">avocado</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>

<span class="c1"># Define the peak season</span>
<span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">month</span>
<span class="n">peak_months</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>        <span class="c1"># &lt;--------- Set the months for the &quot;peak season&quot;</span>
<span class="k">def</span> <span class="nf">peak_season</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">])</span> <span class="ow">in</span> <span class="n">peak_months</span> <span class="k">else</span> <span class="mi">0</span>

<span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avocado</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">peak_season</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Scale the number of avocados to millions</span>
<span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000000</span>

<span class="c1"># Select only conventional avocados</span>
<span class="n">avocado</span> <span class="o">=</span> <span class="n">avocado</span><span class="p">[</span><span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Conventional&#39;</span><span class="p">]</span>

<span class="n">avocado</span> <span class="o">=</span> <span class="n">avocado</span><span class="p">[[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;units_sold&#39;</span><span class="p">,</span><span class="s1">&#39;price&#39;</span><span class="p">,</span><span class="s1">&#39;region&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;year_index&#39;</span><span class="p">,</span><span class="s1">&#39;peak&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">avocado</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>units_sold</th>
      <th>price</th>
      <th>region</th>
      <th>year</th>
      <th>month</th>
      <th>year_index</th>
      <th>peak</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-04</td>
      <td>3.382800</td>
      <td>1.020000</td>
      <td>Great_...</td>
      <td>2015</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-04</td>
      <td>2.578275</td>
      <td>1.100000</td>
      <td>Midsouth</td>
      <td>2015</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-04</td>
      <td>5.794411</td>
      <td>0.890000</td>
      <td>West</td>
      <td>2015</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-04</td>
      <td>3.204112</td>
      <td>0.980000</td>
      <td>Southeast</td>
      <td>2015</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-04</td>
      <td>0.321824</td>
      <td>1.050000</td>
      <td>Northe...</td>
      <td>2015</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3397</th>
      <td>2022-05-15</td>
      <td>4.150433</td>
      <td>1.269883</td>
      <td>SouthC...</td>
      <td>2022</td>
      <td>5</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3398</th>
      <td>2022-05-15</td>
      <td>4.668815</td>
      <td>1.644873</td>
      <td>Northeast</td>
      <td>2022</td>
      <td>5</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3399</th>
      <td>2022-05-15</td>
      <td>32.745321</td>
      <td>1.527357</td>
      <td>Total_US</td>
      <td>2022</td>
      <td>5</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3400</th>
      <td>2022-05-15</td>
      <td>3.542902</td>
      <td>1.514583</td>
      <td>Midsouth</td>
      <td>2022</td>
      <td>5</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3401</th>
      <td>2022-05-15</td>
      <td>1.560202</td>
      <td>1.541429</td>
      <td>Plains</td>
      <td>2022</td>
      <td>5</td>
      <td>7</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>3402 rows × 8 columns</p>
</div></div>
</div>
</section>
<section id="Part-I:-Observe-Trends-in-the-Data">
<h2>Part I: Observe Trends in the Data<a class="headerlink" href="#Part-I:-Observe-Trends-in-the-Data" title="Permalink to this heading"></a></h2>
<p>Now, we will infer sales trends in time and seasonality. For simplicity, let’s proceed with data from the United States as a whole.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_Total_US</span> <span class="o">=</span> <span class="n">avocado</span><span class="p">[</span><span class="n">avocado</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Total_US&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<section id="Sales-Over-the-Years">
<h3>Sales Over the Years<a class="headerlink" href="#Sales-Over-the-Years" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">mean</span> <span class="o">=</span> <span class="n">df_Total_US</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std</span>  <span class="o">=</span> <span class="n">df_Total_US</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">axes</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">std</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Units Sold (millions)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/mlm-examples_price_optimization_9_0.png" src="../_images/mlm-examples_price_optimization_9_0.png" />
</div>
</div>
<p>We can see that the sales generally increased over the years, albeit marginally. The dip in 2019 is the effect of the well-documented <a class="reference external" href="https://abc7news.com/avocado-shortage-season-prices/5389855/">2019 avocado shortage</a> that led to avocados <a class="reference external" href="https://abc7news.com/avocado-shortage-season-prices/5389855/">nearly doubling in price.</a></p>
</section>
<section id="Seasonality">
<h3>Seasonality<a class="headerlink" href="#Seasonality" title="Permalink to this heading"></a></h3>
<p>We will now see the sales trends within a year.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">mean</span> <span class="o">=</span> <span class="n">df_Total_US</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std</span>  <span class="o">=</span> <span class="n">df_Total_US</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">axes</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">std</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Units Sold (millions)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Units sold (millions)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/mlm-examples_price_optimization_11_0.png" src="../_images/mlm-examples_price_optimization_11_0.png" />
</div>
</div>
<p>We see a Super Bowl peak in February and a Cinco de Mayo peak in May.</p>
</section>
<section id="Correlations">
<h3>Correlations<a class="headerlink" href="#Correlations" title="Permalink to this heading"></a></h3>
<p>Now, we will see how the variables are correlated with each other. The end goal is to predict sales given the price of an avocado, year and seasonality (peak or not).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df_Total_US</span><span class="p">[[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;peak&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span><span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>

<span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Correlations for conventional avocados&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/mlm-examples_price_optimization_13_0.png" src="../_images/mlm-examples_price_optimization_13_0.png" />
</div>
</div>
<p>As expected, the sales quantity has a negative correlation with the price per avocado. The sales quantity has a positive correlation with the year and season being a peak season.</p>
</section>
<section id="Regions">
<h3>Regions<a class="headerlink" href="#Regions" title="Permalink to this heading"></a></h3>
<p>Finally, we will see how the sales differ among the different regions. This will determine the number of avocados that we want to supply to each region.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Great_Lakes&#39;</span><span class="p">,</span><span class="s1">&#39;Midsouth&#39;</span><span class="p">,</span><span class="s1">&#39;Northeast&#39;</span><span class="p">,</span><span class="s1">&#39;Northern_New_England&#39;</span><span class="p">,</span><span class="s1">&#39;SouthCentral&#39;</span><span class="p">,</span><span class="s1">&#39;Southeast&#39;</span><span class="p">,</span><span class="s1">&#39;West&#39;</span><span class="p">,</span><span class="s1">&#39;Plains&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">avocado</span><span class="p">[</span><span class="n">avocado</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">regions</span><span class="p">)]</span>

<span class="n">mean</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">)[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std</span>  <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">)[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">axes</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">)),</span> <span class="n">mean</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">std</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Region&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">)),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean</span><span class="p">)[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Units sold (millions)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/mlm-examples_price_optimization_15_0.png" src="../_images/mlm-examples_price_optimization_15_0.png" />
</div>
</div>
<p>Clearly, west-coasters love avocados.</p>
</section>
</section>
<section id="Part-II:-Predict-the-Sales">
<h2>Part II: Predict the Sales<a class="headerlink" href="#Part-II:-Predict-the-Sales" title="Permalink to this heading"></a></h2>
<p>The trends observed in Part I motivate us to construct a prediction model for sales using the independent variables - price, year, region and seasonality. Henceforth, the sales quantity will be referred to as the <em>predicted demand</em>.</p>
<p>Let us now construct a linear regressor for the demand. Note that the region is a categorical variable. The linear regressor can be mathematically expressed as:</p>
<div class="math notranslate nohighlight">
\[demand = \beta_0 + \beta_1 \cdot price + \sum\limits_{region} \beta^{region}_3 \cdot \mathbb{1}(region)  +  \beta_4 w_{year} \cdot year +  \beta_5  \cdot \mathbb{1}(peak).\]</div>
<p>Here, the <span class="math notranslate nohighlight">\(\beta\)</span> values are weights (or “co-efficients”) that have to be learned from the data. Note that the notation <span class="math notranslate nohighlight">\(\mathbb{1}(region)\)</span> is an indicator function that takes the value <span class="math notranslate nohighlight">\(1\)</span> for each region in the summation. The value of <span class="math notranslate nohighlight">\(\mathbb{1}(peak)\)</span> is <span class="math notranslate nohighlight">\(1\)</span> if we consider the peak season.</p>
<p>To validate the regression model, we will randomly split the dataset into <span class="math notranslate nohighlight">\(80\%\)</span> training and <span class="math notranslate nohighlight">\(20\%\)</span> testing data and learn the weights using sklearn.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="kn">from</span> <span class="nn">gurobi_ml</span> <span class="kn">import</span> <span class="n">add_predictor_constr</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regions</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;Great_Lakes&#39;,
 &#39;Midsouth&#39;,
 &#39;Northeast&#39;,
 &#39;Northern_New_England&#39;,
 &#39;SouthCentral&#39;,
 &#39;Southeast&#39;,
 &#39;West&#39;,
 &#39;Plains&#39;]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Great_Lakes&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Midsouth&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Northeast&#39;</span><span class="p">,</span>
           <span class="s1">&#39;West&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;units_sold&#39;</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;year_index&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;peak&#39;</span><span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">target</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">features</span><span class="p">]</span>

<span class="n">subset</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">regions</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">subset</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">subset</span><span class="p">]</span>
<span class="n">X</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>year_index</th>
      <th>region</th>
      <th>peak</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.020000</td>
      <td>0</td>
      <td>Great_...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.100000</td>
      <td>0</td>
      <td>Midsouth</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.890000</td>
      <td>0</td>
      <td>West</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.090000</td>
      <td>0</td>
      <td>Northeast</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.950000</td>
      <td>0</td>
      <td>West</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3389</th>
      <td>1.472110</td>
      <td>7</td>
      <td>West</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3394</th>
      <td>1.546669</td>
      <td>7</td>
      <td>West</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3395</th>
      <td>1.557276</td>
      <td>7</td>
      <td>Great_...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3398</th>
      <td>1.644873</td>
      <td>7</td>
      <td>Northeast</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3400</th>
      <td>1.514583</td>
      <td>7</td>
      <td>Midsouth</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>1512 rows × 4 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transform</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">((</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]),</span> <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span><span class="p">,</span>
                                    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split the data for training and testing</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Train the model</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">MLPRegressor</span><span class="p">([</span><span class="mi">10</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Get R^2 from test data</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The R^2 value in the test set is&quot;</span><span class="p">,</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The R^2 value in the test set is 0.8637413176543106
</pre></div></div>
</div>
<p>We can observe a good <span class="math notranslate nohighlight">\(R^2\)</span> value in the test set. We will now fit the weights to the full dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">y_pred_full</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The R^2 value in the full dataset is&quot;</span><span class="p">,</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred_full</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The R^2 value in the full dataset is 0.8762205535340608
</pre></div></div>
</div>
</section>
<section id="Part-III:-Optimize-for-Price-and-Supply-of-Avocados">
<h2>Part III: Optimize for Price and Supply of Avocados<a class="headerlink" href="#Part-III:-Optimize-for-Price-and-Supply-of-Avocados" title="Permalink to this heading"></a></h2>
<p>Knowing how the price of an avocado affects the demand, how can we set the optimal avocado price? We don’t want to set the price too high, since that could drive demand and sales down. At the same time, setting the price too low could be sub-optimal when maximizing revenue. So what is the sweet spot?</p>
<p>On the distribution logistics, we want to make sure that there are enough avocados across the regions. We can address these considerations in a mathematical optimization model. An optimization model finds the <strong>best solution</strong> according to an <strong>objective function</strong> such that the solution satisfies a set of <strong>constraints</strong>. Here, a solution is expressed as a vector of real values or integer values called <strong>decision variables</strong>. Constraints are a set of equations or inequalities written as a
function of the decision variables.</p>
<p>At the start of each week, assume that the total number of available products is finite. This quantity needs to be distributed to the various regions while maximizing net revenue. So there are two key decisions - the price of an avocado in each region, and the number of avocados allocated to each region.</p>
<p>Let us now define some input parameters and notations used for creating the model. The subscript <span class="math notranslate nohighlight">\(r\)</span> will be used to denote each region.</p>
<section id="Input-Parameters">
<h3>Input Parameters<a class="headerlink" href="#Input-Parameters" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(R\)</span>: set of regions,</p></li>
<li><p><span class="math notranslate nohighlight">\(d(p,r)\)</span>: predicted demand in region <span class="math notranslate nohighlight">\(r\in R\)</span> when the avocado per product is <span class="math notranslate nohighlight">\(p\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(B\)</span>: available avocados to be distributed across the regions,</p></li>
<li><p><span class="math notranslate nohighlight">\(c_{waste}\)</span>: cost (<span class="math notranslate nohighlight">\(\$\)</span>) per wasted avocado,</p></li>
<li><p><span class="math notranslate nohighlight">\(c^r_{transport}\)</span>: cost (<span class="math notranslate nohighlight">\(\$\)</span>) of transporting an avocado to region <span class="math notranslate nohighlight">\(r \in R\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(a^r_{min},a^r_{max}\)</span>: minimum and maximum price (<span class="math notranslate nohighlight">\(\$\)</span>) per avocado for reigon <span class="math notranslate nohighlight">\(r \in R\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(b^r_{min},b^r_{max}\)</span>: minimum and maximum number of avocados allocated to region <span class="math notranslate nohighlight">\(r \in R\)</span>,</p></li>
</ul>
<p>The following code loads the Gurobi python package and initiates the optimization model. The value of <span class="math notranslate nohighlight">\(B\)</span> is set to <span class="math notranslate nohighlight">\(30\)</span> million avocados, which is close to the average weekly supply value from the data. For illustration, let us consider the peak season of 2021. The cost of wasting an avocado is set to <span class="math notranslate nohighlight">\(\$0.10\)</span>. The cost of transporting an avocado ranges between <span class="math notranslate nohighlight">\(\$0.10\)</span> to <span class="math notranslate nohighlight">\(\$0.50\)</span> based on each region’s distance from the southern border, where the <a class="reference external" href="https://www.britannica.com/plant/avocado">majority of
avocado supply comes from</a>. Further, we can set the price of an avocado to not exceed <span class="math notranslate nohighlight">\(\$ 2\)</span> apiece.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Great_Lakes&#39;</span><span class="p">,</span>
 <span class="s1">&#39;West&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Northeast&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gurobipy</span> <span class="k">as</span> <span class="nn">gp</span>
<span class="kn">from</span> <span class="nn">gurobipy</span> <span class="kn">import</span> <span class="n">GRB</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;Avocado_Price_Allocation&quot;</span><span class="p">)</span>

<span class="c1"># Sets and parameters</span>
<span class="n">R</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">)</span>   <span class="c1"># set of all regions</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># total amount ot avocado supply</span>

<span class="n">peak_or_not</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># 1 if it is the peak season; 1 if isn&#39;t</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2022</span>

<span class="n">c_waste</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># the cost ($) of wasting an avocado</span>

<span class="c1"># the cost of transporting an avocado</span>
<span class="n">c_transport</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s1">&#39;Great_Lakes&#39;</span><span class="p">:</span> <span class="mf">.3</span><span class="p">,</span>
                         <span class="s1">&#39;Midsouth&#39;</span><span class="p">:</span><span class="mf">.1</span><span class="p">,</span>
                         <span class="s1">&#39;Northeast&#39;</span><span class="p">:</span><span class="mf">.4</span><span class="p">,</span>
                         <span class="s1">&#39;Northern_New_England&#39;</span><span class="p">:</span><span class="mf">.5</span><span class="p">,</span>
                         <span class="s1">&#39;SouthCentral&#39;</span><span class="p">:</span><span class="mf">.3</span><span class="p">,</span>
                         <span class="s1">&#39;Southeast&#39;</span><span class="p">:</span><span class="mf">.2</span><span class="p">,</span>
                         <span class="s1">&#39;West&#39;</span><span class="p">:</span><span class="mf">.2</span><span class="p">,</span>
                         <span class="s1">&#39;Plains&#39;</span><span class="p">:</span><span class="mf">.2</span><span class="p">})</span>
<span class="n">c_transport</span> <span class="o">=</span> <span class="n">c_transport</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">regions</span><span class="p">]</span>
<span class="c1"># Get the lower and upper bounds from the dataset for the price and the number of products to be stocked</span>
<span class="n">a_min</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># minimum avocado price in each region</span>
<span class="n">a_max</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># maximum avocado price in each region</span>
<span class="n">b_min</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">)[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">regions</span><span class="p">]</span>  <span class="c1"># minimum number of avocados allocated to each region</span>
<span class="n">b_max</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">)[</span><span class="s1">&#39;units_sold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">regions</span><span class="p">]</span>   <span class="c1"># maximum number of avocados allocated to each region</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Gurobi 10.0.0 (beta1) - expires 2022-11-21
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute bounds for the features</span>

<span class="c1"># First create a data frame indexed by the regions and with the features</span>
<span class="c1"># as columns</span>
<span class="n">feat_bounds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">regions</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">features</span><span class="p">)</span>
<span class="n">feat_bounds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_min</span>
<span class="n">feat_bounds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peak_or_not</span>
<span class="n">feat_bounds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;year_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span> <span class="o">-</span> <span class="mi">2015</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
    <span class="n">feat_bounds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>

<span class="c1"># Now we use our transform to transform the data to the space of the regression</span>
<span class="n">feat_bounds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">feat_bounds</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">transform</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>

<span class="c1"># Finally we can store the bounds</span>
<span class="c1"># Price is the only feature that is not fixed and has a different upper bound</span>
<span class="n">feat_lb</span> <span class="o">=</span> <span class="n">feat_bounds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">feat_bounds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_max</span>
<span class="n">feat_ub</span> <span class="o">=</span> <span class="n">feat_bounds</span>
</pre></div>
</div>
</div>
</section>
<section id="Decision-Variables">
<h3>Decision Variables<a class="headerlink" href="#Decision-Variables" title="Permalink to this heading"></a></h3>
<p>Let us now define the decision variables. In our model, we want to store the price and number of avocados allocated to each region. We also want variables that track how many avocados are predicted to be sold and how many are predicted to be wasted. The following notation is used to model these decision variables, indexed for each region <span class="math notranslate nohighlight">\(r\)</span>.</p>
<p><span class="math notranslate nohighlight">\(p_r\)</span>: the price of an avocado (<span class="math notranslate nohighlight">\(\$\)</span>) in region <span class="math notranslate nohighlight">\(r\)</span>,</p>
<p><span class="math notranslate nohighlight">\(x_r\)</span>: the number of avocados supplied to region <span class="math notranslate nohighlight">\(r\)</span>,</p>
<p><span class="math notranslate nohighlight">\(s_r = \min \{x_r,d_r(p_r)\}\)</span>: the predicted number of avocados sold in region <span class="math notranslate nohighlight">\(r\)</span>,</p>
<p><span class="math notranslate nohighlight">\(w_r = x_r - s_r\)</span>: the predicted number of avocados wasted in region <span class="math notranslate nohighlight">\(r\)</span></p>
<p>We will now add the variables to the Gurobi model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addMVar</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="n">lb</span><span class="o">=</span><span class="n">b_min</span><span class="p">,</span><span class="n">ub</span><span class="o">=</span><span class="n">b_max</span><span class="p">)</span>  <span class="c1"># quantity supplied to each region</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addMVar</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># predicted amount of sales in each region for the given price</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addMVar</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># excess wasteage in each region</span>

<span class="c1"># Add variables for the regression</span>
<span class="n">feats</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addMVar</span><span class="p">((</span><span class="n">R</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">lb</span><span class="o">=</span><span class="n">feat_lb</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">ub</span><span class="o">=</span><span class="n">feat_ub</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;reg_features&#39;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addMVar</span><span class="p">((</span><span class="n">R</span><span class="p">),</span> <span class="n">lb</span><span class="o">=-</span><span class="n">gp</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;reg_output&#39;</span><span class="p">)</span>

<span class="c1"># Get the price variables from the features of the regression</span>
<span class="n">price_index</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">feats</span><span class="p">[:,</span> <span class="n">price_index</span><span class="p">]</span>
<span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Set-the-Objective">
<h3>Set the Objective<a class="headerlink" href="#Set-the-Objective" title="Permalink to this heading"></a></h3>
<p>Next, we will define the objective function: we want to maximize the <strong>net revenue</strong>. The revenue from sales in each region is calculated by the price of an avocado in that region multiplied by the quantity sold there. There are two types of costs incurred: the wastage costs for excess unsold avocados and the cost of transporting the avocados to the different regions.</p>
<p>The net revenue is the sales revenue subtracted by the total costs incurred. We assume that the purchase costs are fixed and are not incorporated in this model.</p>
<p>Using the defined decision variables, the objective can be written as follows.</p>
<div class="math notranslate nohighlight">
\[\textrm{maximize} \, \sum_{r}  (p_r \cdot s_r - c_{waste} \cdot w_r - c^r_{transport} \cdot x_r)\]</div>
<p>Let us now add the objective function to the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">p</span><span class="nd">@s</span> <span class="o">-</span> <span class="n">c_waste</span> <span class="o">*</span> <span class="n">w</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">-</span> <span class="n">c_transport</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">@</span> <span class="n">x</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">ModelSense</span> <span class="o">=</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MAXIMIZE</span>
</pre></div>
</div>
</div>
</section>
<section id="Add-the-Supply-Constraint">
<h3>Add the Supply Constraint<a class="headerlink" href="#Add-the-Supply-Constraint" title="Permalink to this heading"></a></h3>
<p>We now introduce the constraints. The first constraint is to make sure that the total number of avocados supplied is equal to <span class="math notranslate nohighlight">\(B\)</span>, which can be mathematically expressed as follows.</p>
<div class="math notranslate nohighlight">
\[\sum_{r} x_r = B\]</div>
<p>The following code adds this constraint to the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Add-Constraints-That-Define-Sales-Quantity">
<h3>Add Constraints That Define Sales Quantity<a class="headerlink" href="#Add-Constraints-That-Define-Sales-Quantity" title="Permalink to this heading"></a></h3>
<p>Next, we should define the predicted sales quantity in each region. We can assume that if we supply more than the predicted demand, we sell exactly the predicted demand. Otherwise, we sell exactly the allocated amount. Hence, the predicted sales quantity is the minimum of the allocated quantity and the predicted demand, i.e., <span class="math notranslate nohighlight">\(s_r = \min \{x_r,d_r(p_r)\}\)</span>. This relationship can be modeled by the following two constraints for each region <span class="math notranslate nohighlight">\(r\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
s_r &amp;\leq x_r  \\
s_r &amp;\leq d(p_r,r)
\end{aligned}\end{split}\]</div>
<p>These constraints will ensure that the sales quantity <span class="math notranslate nohighlight">\(s_r\)</span> in region <span class="math notranslate nohighlight">\(r\)</span> is greater than neither the allocated quantity nor the predicted demand. Note that the maximization objective function tries to maximize the revenue from sales, and therefore the optimizer will maximize the predicted sales quantity. This is assuming that the surplus and transportation costs are less than the sales price per avocado. Hence, these constraints along with the objective will ensure that the sales
are equal to the minimum of supply and predicted demand.</p>
<p>Let us now add these constraints to the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Add-the-Wastage-Constraints">
<h3>Add the Wastage Constraints<a class="headerlink" href="#Add-the-Wastage-Constraints" title="Permalink to this heading"></a></h3>
<p>Finally, we should define the predicted wastage in each region, given by the supplied quantity that is not predicted to be sold. We can express this mathematically for each region <span class="math notranslate nohighlight">\(r\)</span>.</p>
<div class="math notranslate nohighlight">
\[w_r = x_r - s_r\]</div>
<p>We can add these constraints to the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">w</span> <span class="o">==</span> <span class="n">x</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_constr</span> <span class="o">=</span> <span class="n">add_predictor_constr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_constr</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model for PipelineConstr1:
138 variables
81 constraints
60 general constraints
Input has shape (3, 6)
Output has shape (3, 1)

Pipeline has 2 steps:
standardscaler1 mlpregressor1

Model for standardscaler1:
18 variables
18 constraints
Input has shape (3, 6)
Output has shape (3, 6)

Model for mlpregressor1:
120 variables
63 constraints
60 general constraints
Input has shape (3, 6)
Output has shape (3, 1)

mlpregressor1 has 3 layers:
Model for layer0:
60 variables
30 constraints
30 general constraints
Input has shape (3, 6)
Output has shape (3, 10)
Activation is relu

Model for layer1:
60 variables
30 constraints
30 general constraints
Input has shape (3, 10)
Output has shape (3, 10)
Activation is relu

Model for layer2:
0 variables
3 constraints
Input has shape (3, 10)
Output has shape (3, 1)
Activation is identity


</pre></div></div>
</div>
</section>
<section id="Fire-Up-the-Solver">
<h3>Fire Up the Solver<a class="headerlink" href="#Fire-Up-the-Solver" title="Permalink to this heading"></a></h3>
<p>We have added the decision variables, objective function, and the constraints to the model. The model is ready to be solved. Before we do so, we should let the solver know what type of model this is. The default setting assumes that the objective and the constraints are linear functions of the variables.</p>
<p>In our model, the objective is <strong>quadratic</strong> since we take the product of price and the predicted sales, both of which are variables. Maximizing a quadratic term is said to be <strong>non-convex</strong>, and we specify this by setting the value of the Gurobi parameter <strong>NonConvex</strong> to be <span class="math notranslate nohighlight">\(2\)</span>. See <a class="reference external" href="https://www.gurobi.com/documentation/9.5/refman/nonconvex.html">the documentation of the NonConvex parameter</a> for more details.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">Params</span><span class="o">.</span><span class="n">NonConvex</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">m</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Set parameter NonConvex to value 2
Gurobi Optimizer version 10.0.0 build v10.0.0beta1 (mac64[x86])

CPU model: Intel(R) Core(TM) i5-1038NG7 CPU @ 2.00GHz
Thread count: 4 physical cores, 8 logical processors, using up to 8 threads

Optimize a model with 91 rows, 168 columns and 633 nonzeros
Model fingerprint: 0x9d1cb582
Model has 3 quadratic objective terms
Model has 60 general constraints
Variable types: 168 continuous, 0 integer (0 binary)
Coefficient statistics:
  Matrix range     [3e-13, 2e+00]
  Objective range  [2e-01, 5e-01]
  QObjective range [2e+00, 2e+00]
  Bounds range     [6e-01, 1e+01]
  RHS range        [4e-02, 2e+01]
Presolve added 12 rows and 0 columns
Presolve removed 0 rows and 63 columns
Presolve time: 0.01s
Presolved: 110 rows, 109 columns, 412 nonzeros
Presolved model has 3 bilinear constraint(s)
Variable types: 80 continuous, 29 integer (29 binary)

Root relaxation: objective 2.600815e+01, 66 iterations, 0.00 seconds (0.00 work units)

    Nodes    |    Current Node    |     Objective Bounds      |     Work
 Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time

     0     0   26.00815    0   12          -   26.00815      -     -    0s
H    0     0                      16.6825552   26.00815  55.9%     -    0s
     0     0   25.09093    0   17   16.68255   25.09093  50.4%     -    0s
H    0     0                      19.1700877   25.09093  30.9%     -    0s
     0     0   25.07771    0   17   19.17008   25.07771  30.8%     -    0s
     0     0   23.92957    0   26   19.17008   23.92957  24.8%     -    0s
     0     0   23.92616    0   22   19.17008   23.92616  24.8%     -    0s
     0     0   23.79254    0   21   19.17008   23.79254  24.1%     -    0s
     0     0   23.66890    0   19   19.17008   23.66890  23.5%     -    0s
     0     0   23.66279    0   20   19.17008   23.66279  23.4%     -    0s
     0     0   23.58215    0   20   19.17008   23.58215  23.0%     -    0s
     0     0   23.58206    0   19   19.17008   23.58206  23.0%     -    0s
     0     0   23.57835    0   18   19.17008   23.57835  23.0%     -    0s
     0     0   22.98228    0   18   19.17008   22.98228  19.9%     -    0s
     0     0   21.78701    0   19   19.17008   21.78701  13.7%     -    0s
H    0     0                      19.4975215   21.41470  9.83%     -    0s
     0     0   21.37648    0   20   19.49752   21.37648  9.64%     -    0s
     0     0   20.97685    0   20   19.49752   20.97685  7.59%     -    0s
H    0     0                      19.7001589   20.97685  6.48%     -    0s
H    0     0                      19.7835664   20.97685  6.03%     -    0s
     0     0   20.64916    0   17   19.78356   20.64916  4.38%     -    0s
     0     0   20.47167    0   19   19.78356   20.47167  3.48%     -    0s
H    0     0                      19.8016529   20.47167  3.38%     -    0s
H    0     0                      19.8176479   20.25866  2.23%     -    0s
     0     0   20.25866    0   19   19.81764   20.25866  2.23%     -    0s
     0     0   20.17271    0   19   19.81764   20.17271  1.79%     -    0s
     0     2   20.17271    0   19   19.81764   20.17271  1.79%     -    0s
H   94     6                      19.8176912   19.81798  0.00%   5.8    0s
*   96     6              23      19.8176936   19.81798  0.00%   5.7    0s
H   99     6                      19.8179313   19.81794  0.00%   5.6    0s

Cutting planes:
  Gomory: 6
  Cover: 1
  Implied bound: 14
  Clique: 3
  MIR: 7
  Flow cover: 11
  RLT: 9
  Relax-and-lift: 5
  BQP: 1
  PSD: 2

Explored 102 nodes (911 simplex iterations) in 0.16 seconds (0.05 work units)
Thread count was 8 (of 8 available processors)

Solution count 9: 19.8179 19.8177 19.8176 ... 16.6826

Optimal solution found (tolerance 1.00e-04)
Best objective 1.981793091464e+01, best bound 1.981794764962e+01, gap 0.0001%
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximal error in predicted values in solution </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pred_constr</span><span class="o">.</span><span class="n">get_error</span><span class="p">()))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Maximal error in predicted values in solution 3.4988534736157817e-07
</pre></div></div>
</div>
<p>The solver solved the optimization problem in less than a second. Let us now analyze the optimal solution by storing it in a Pandas dataframe.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">solution</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">solution</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regions</span>
<span class="n">solution</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">X</span>
<span class="n">solution</span><span class="p">[</span><span class="s1">&#39;Allocated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">solution</span><span class="p">[</span><span class="s1">&#39;Sold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">solution</span><span class="p">[</span><span class="s1">&#39;Wasted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">solution</span><span class="p">[</span><span class="s1">&#39;Pred_demand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">opt_revenue</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">ObjVal</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> The optimal net revenue: $</span><span class="si">%f</span><span class="s2"> million&quot;</span><span class="o">%</span><span class="k">opt_revenue</span>)
<span class="n">solution</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 The optimal net revenue: $19.817931 million
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Region</th>
      <th>Price</th>
      <th>Allocated</th>
      <th>Sold</th>
      <th>Wasted</th>
      <th>Pred_demand</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Great_Lakes</td>
      <td>1.999994</td>
      <td>3.0814</td>
      <td>3.0814</td>
      <td>-0.0</td>
      <td>3.0814</td>
    </tr>
    <tr>
      <th>1</th>
      <td>West</td>
      <td>1.187608</td>
      <td>7.3322</td>
      <td>7.3322</td>
      <td>0.0</td>
      <td>7.3322</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Northeast</td>
      <td>2.000000</td>
      <td>4.5863</td>
      <td>4.5863</td>
      <td>0.0</td>
      <td>4.5863</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Let us now visualize a scatter plot between the price and the number of avocados sold (in millions) for the eight regions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot_sol</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">solution</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Sold&#39;</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Region&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plot_waste</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">solution</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Wasted&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Region&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">plot_sol</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot_waste</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Price per avocado ($)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of avocados sold (millions)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The circles represent sales quantity and the cross markers represent the wasted quantity.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/mlm-examples_price_optimization_48_0.png" src="../_images/mlm-examples_price_optimization_48_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The circles represent sales quantity and the cross markers represent the wasted quantity.
</pre></div></div>
</div>
<p>Copyright © 2022 Gurobi Optimization, LLC</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="student_admission.html" class="btn btn-neutral float-left" title="Student Enrollment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../meta-api.html" class="btn btn-neutral float-right" title="API Reference manual" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Gurobi Optimization, LLC. All Rights Reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
